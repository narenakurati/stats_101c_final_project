---
title: "Final Project"
author: "Naren Akurati"
date: "11/24/2018"
output: html_document
---

```{r}
library(testthat)
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(gridExtra))
library(class)
library(ISLR)
suppressPackageStartupMessages(library(caret))
library(e1071)
suppressPackageStartupMessages(library(MASS))
library(reshape2)
library(ggcorrplot)
suppressPackageStartupMessages(library(boot))
suppressPackageStartupMessages(library(resample))
library(rpart)
library(tree)
suppressPackageStartupMessages(library(randomForest))
library(xgboost)
```

```{r}
#read in the data
train <- read.csv("HTrainLast.csv")
test <- read.csv("HTestLastNoY.csv")

#find out which predictors have the most NAs
tb1 <- as.data.frame(colSums(is.na(train)))
tb1 <- setNames(cbind(rownames(tb1), tb1, row.names = NULL), c("predictor", "na_count"))
tb1 %>% group_by(predictor) %>% arrange(desc(na_count))

#remove troublesome predictors with most NAs
trouble <- c("PoolQC", "MiscFeature", "Alley", "Fence", "FireplaceQu", "LotFrontage")
train_r <- subset(train, select = -which(names(train) %in% trouble))
test_r <- subset(test, select = -which(names(train) %in% trouble))

#check NAs again
tb2 <- as.data.frame(colSums(is.na(train_r)))
tb2 <- setNames(cbind(rownames(tb2), tb2, row.names = NULL), c("predictor", "na_count"))
tb2 %>% group_by(predictor) %>% arrange(desc(na_count))

tb3 <- as.data.frame(colSums(is.na(test_r)))
tb3 <- setNames(cbind(rownames(tb3), tb3, row.names = NULL), c("predictor", "na_count"))
tb3 %>% group_by(predictor) %>% arrange(desc(na_count))

#drop first column in both train and test
train_r <- train_r[,2:75]
test_r <- test_r[,2:74]

#dropping variables with less than 2 levels
#train_r <- train_r[, sapply(train_r, function(col) length(unique(col))) > 1] #drops utility
myvars <- names(train_r) %in% c("Utilities")
train_r <- train_r[!myvars]

myvars <-names(test_r) %in% c("Utilities")
test_r <- test_r[!myvars]
```

```{r}
#investigating remaining variables
#out of 73 variables, 38 are categorical
class <- sapply(train_r, class)
#length(class)
#length(which(class == "factor"))

class <- as.data.frame(class)
class
which(class == "factor")

length(train_r$LotArea[train_r$LotArea < quantile(train_r$LotArea)[4][[1]]])

plot(train_r$YearRemodAdd ~ train_r$affordabilitty)

plot(train_r$LotArea[train_r$LotArea < quantile(train_r$LotArea)[4][[1]]] ~ train_r$affordabilitty[which(train_r$LotArea < quantile(train_r$LotArea)[4][[1]])])
```

```{r}
#omit remaining NAs
train_r_2 <- na.omit(train_r)
#going from 3500 to 3205 observations

#dealing with NAs in test data

#logistic regression
logistic_model <- glm(formula = affordabilitty ~ ., data = train_r_3, family = binomial())
prediction <- predict(logistic_model, type = "response")
prediction <- ifelse (prediction < 0.5, "Unaffordable", "Affordable")
prediction <- as.factor(prediction)
table(prediction, train_r_3$affordabilitty)
mean(prediction != train_r_3$affordabilitty)

#test_predict <- predict(logistic_model, test, type = "response")
```